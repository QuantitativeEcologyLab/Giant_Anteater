---
title: "giantanteater rmarkdown"
output: html_document
date: "2023-01-20"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(root.dir = "C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory (giant anteater)")
# setting working directory for entire rmarkdown file instead of chunks, which is a default of a rmarkdown file
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

# BIOL 452 Directed Studies - Giant Anteater Sociality

## install R packages
```{r}
install.packages("rmarkdown")
install.packages("knitr")
install.packages("readr")
install.packages("ctmm")
install.packages("dplyr")
install.packages("tidyr")
install.packages("ggplot")
install.packages("lme4")
install.packages("lubridate")
```

## install Github packages not on CRAN
```{r}
devtools::install_github("r-lib/devtools", force = TRUE)
devtools::install_github("ctmm-initiative/ctmm")
devtools::install_github("jmcalabrese/corrMove", force = TRUE)
```


## Load packages
```{r}
library("rmarkdown")
library("knitr")
library("readr")
library("ctmm")
library("dplyr")
library("tidyr")
library("ggplot")
library("lme4")
library("devtools")
library("corrMove")
library("lubridate") # for round_date() for corrMove
```

# DATA PREPARATION

## Set working directory
```{r}
setwd("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory")
```

## IMPORT DATASET
```{r}
giantanteater <- read_csv("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/giant anteater data/Anteaters_NoOutliers (original data).csv")
```

## TELEMETRY FORMAT
Convert dataset to a telemetry object, assuming the data has been cleaned and containing no outliers
```{r}
DATA <- as.telemetry("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/giant anteater data/Anteaters_NoOutliers (original data).csv")
```


## SUBSET DATA FOR SITE 1
```{r}
site.1 <- DATA[c(1,3,9,10,12,15,21,24,27,29,36,38)] # male and female (n=12)
site.1.adult <- DATA[c(1,9,10,12,15,21,29,36,38)] # adult (n=9)
site.1.male <- DATA[c(1,3,12,21,24,27,38)] # male (n=7)
site.1.male.adult <- DATA[c(1,12,21,38)] # male adult (n=4)
site.1.female <- DATA[c(9,10,15,29,36)] # female adult (n=5)
```

## SUBSET DATA FOR SITE 2
```{r}
site.2 <- DATA[c(2,8,22,25,30,37,42)] # male and female (n=7)
site.2.adult <- DATA[c(2,8,22,25,30,42)] # adult (n=6)
site.2.male <- DATA[c(8,25,37,42)]  # male (n=4)
site.2.male.adult <- DATA[c(8,25,42)] # male adult (n=3)
site.2.female <- DATA[c(2,22,30)]  # female adult (n=3)
```

## SUBSET DATA FOR SITE 3
```{r}
site.3 <- DATA[c()] # male and female (n=)
site.3.adult <- DATA[c()] # adult (n=)
site.3.male <- DATA[c()]  # male (n=)
site.3.male.adult <- DATA[c()] # male adult (n=)
site.3.female <- DATA[c()]  # female adult (n=)
```

# OVERLAP
## FITTING MODELS
### FITTING MODELS FOR SITE 1

#### SITE 1 - male and female (n=12)
```{r}
GUESS.1 <- lapply(site.1[1:12], function(b) ctmm.guess(b,interactive=FALSE) )
FIT.1 <- lapply(1:12, function(i) ctmm.select(site.1[[i]],GUESS.1[[i]]) )
names(FIT.1) <- names(site.1[1:12])
saveRDS(object = FIT.1, file = "FIT.1.RDS")
```

#### Load save fitted model for SITE 1
```{r}
FIT.1 <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/FIT.1.RDS")
overlap(FIT.1)
```

#### SITE 1 - male (n=7)
```{r}
GUESS.1.male <- lapply(site.1.male[1:7], function(b) ctmm.guess(b,interactive=FALSE) )
FIT.1.male <- lapply(1:7, function(i) ctmm.select(site.1.male[[i]],GUESS.1.male[[i]]) )
names(FIT.1.male) <- names(site.1.male[1:7])
saveRDS(object = FIT.1.male, file = "FIT.1.male.RDS")
```

#### Load saved fitted model
```{r}
FIT.1.male <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/FIT.1.male.RDS")
overlap(FIT.1.male)
```

#### SITE 1 - male adult (n=4)
```{r}
GUESS.1.male.adult <- lapply(site.1[1:4], function(b) ctmm.guess(b,interactive=FALSE) )
FIT.1.male.adult <- lapply(1:12, function(i) ctmm.select(site.1.male.adult[[i]],GUESS.1.male.adult[[i]]) )
names(FIT.1.male.adult) <- names(site.1.male.adult[1:4])
saveRDS(object = FIT.1.male.adult, file = "FIT.1.male.adult.RDS")
```

#### Load saved fitted model
```{r}
FIT.1.male.adult <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/FIT.1.male.adult.RDS")
overlap(FIT.1.male.adult)
```

#### SITE 1 - female (n=5)
```{r}
GUESS.1.female <- lapply(site.1.female[1:5], function(b) ctmm.guess(b,interactive=FALSE) )
FIT.1.female <- lapply(1:5, function(i) ctmm.select(site.1.female[[i]],GUESS.1.female[[i]]) )
names(FIT.1.female) <- names(site.1.female[1:5])
saveRDS(object = FIT.1.female, file = "FIT.1.female.RDS")
```

#### Load saved fitted model
```{r}
FIT.1.female <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/FIT.1.female.RDS")
overlap(FIT.1.female)
```

### FITTING MODELS FOR SITE 2 ----

#### SITE 2 - male and female (n=7)
```{r}
GUESS.2 <- lapply(site.2[1:7], function(b) ctmm.guess(b,interactive=FALSE) )
FIT.2 <- lapply(1:7, function(i) ctmm.select(site.2[[i]],GUESS.2[[i]]) )
names(FIT.2) <- names(site.2[1:7])
saveRDS(object = FIT.2, file = "FIT.2.RDS")
```

#### Load saved fitted model
```{r}
FIT.2 <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/FIT.2.RDS")
overlap(FIT.2)
```

#### SITE 2 - male (n=4)
```{r}
GUESS.2.male <- lapply(site.2.male[1:4], function(b) ctmm.guess(b,interactive=FALSE) )
FIT.2.male <- lapply(1:4, function(i) ctmm.select(site.2.male[[i]],GUESS.2.male[[i]]) )
names(FIT.2.male) <- names(site.2.male[1:4])
saveRDS(object = FIT.2.male, file = "FIT.2.male.RDS")
```

#### Load saved fitted model
```{r}
FIT.2.male <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/FIT.2.male.RDS")
overlap(FIT.2.male)
```

#### SITE 2 - male adult (n=3)
```{r}
GUESS.2.male.adult <- lapply(site.2.male.adult[1:3], function(b) ctmm.guess(b,interactive=FALSE) )
FIT.2.male.adult <- lapply(1:3, function(i) ctmm.select(site.2.male.adult[[i]],GUESS.2.male.adult[[i]]) )
names(FIT.2.male.adult) <- names(site.2.male.adult[1:3])
saveRDS(object = FITS.2.male.adult, file = "FIT.2.male.adult.RDS")
```

#### Load saved fitted model
```{r}
FIT.2.male.adult <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/FIT.2.male.adult.RDS")
overlap(FIT.2.male.adult)
```

#### SITE 2 - female (n=3)
```{r}
GUESS.2.female <- lapply(site.2.female[1:3], function(b) ctmm.guess(b,interactive=FALSE) )
FIT.2.female <- lapply(1:3, function(i) ctmm.select(site.2.female[[i]],GUESS.2.female[[i]]) )
names(FIT.2.female) <- names(site.2.female[1:3])
saveRDS(object = FIT.2.female, file = "FIT.2.female.RDS")
```

#### Load saved fitted model
```{r}
FIT.2.female <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/FIT.2.female.RDS")
overlap(FIT.2.female)
```

### FITTING MODELS FOR SITE 3 ---- TO BE COMPLETED

#### SITE 3 - male and female (n=)
```{r}

```

#### Load saved fitted model
```{r}
FIT.3 <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory (giant anteater)/FIT.3.RDS")
overlap(FIT.2)
```

#### SITE 3 - male (n=)
```{r}

```

#### Load saved fitted model
```{r}
FIT.3.male <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory (giant anteater)/FIT.3.male.RDS")
overlap(FIT.3.male)
```

#### SITE 3 - male adult (n=)
```{r}

```

#### Load saved fitted model
```{r}
FIT.3.male.adult <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory (giant anteater)/FIT.3.male.adult.RDS")
overlap(FIT.3.male.adult)
```

#### SITE 3 - female (n=)
```{r}

```

#### Load saved fitted model
```{r}
FIT.3.female <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory (giant anteater)/FIT.3.female.RDS")
overlap(FIT.3.female)
```

## AKDE OVERLAP
### AKDE OVERLAP FOR SITE 1

#### SITE 1 - male and female (n=12)
```{r}
AKDE.1 <- akde(site.1[1:12],FIT.1)
saveRDS(object = AKDE.1, file = "AKDE.1.RDS")
```

#### Load saved AKDE aligned UDs
```{r}
AKDE.1 <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/AKDE.1.RDS")
overlap(AKDE.1)
```

#### Plot AKDE overlap
```{r}
COL.1 <- c("blue", "light blue", "red", "red", "blue", "red", "blue", "light blue", "light blue", "red",
           "red", "blue") # blue = male; light blue = subadult male; red = female
png(file = "Overlap.1.png", width = 6.86, height = 6, units = "in", res = 600)
plot(AKDE.1, col.DF = COL.1, col.level = COL.1, col.grid = NA, level = NA)
title("aKDE Overlap (Site 1: all individuals)")
dev.off()
```

#### SITE 1 - male (n=7)
```{r}
AKDE.1.male <- akde(site.1[1:7],FIT.1.male)
saveRDS(object = AKDE.1.male, file = "AKDE.1.male.RDS")
```

#### Load saved AKDE aligned UDs
```{r}
AKDE.1.male <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/AKDE.1.male.RDS")
overlap(AKDE.1.male)
```

#### Plot AKDE overlap
```{r}
png(file = "Overlap.1.male.png", width = 6.86, height = 6, units = "in", res = 600)
plot(AKDE.1.male, col.DF = "blue", col.level = "black", col.grid = NA, level = NA)
title("aKDE Overlap (Site 1: males only)")
dev.off()
```

#### SITE 1 - male adult (n=4)
```{r}
AKDE.1.male.adult <- akde(site.1.male.adult[1:4],FIT.1.male.adult)
saveRDS(object = AKDE.1.male.adult, file = "AKDE.1.male.adult.RDS")
```

#### Load saved AKDE aligned UDs
```{r}
AKDE.1.male.adult <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/AKDE.1.male.adult.RDS")
overlap(AKDE.1.male.adult)
```

#### Plot AKDE overlap
```{r}
png(file = "Overlap.1.male.adult.png", width = 6.86, height = 6, units = "in", res = 600)
plot(AKDE.1.male.adult, col.DF = "blue", col.level = "black", col.grid = NA, level = NA)
title("aKDE Overlap (Site 1: male adults only)")
dev.off()
```

#### SITE 1 - female (n=5)
```{r}
AKDE.1.female <- akde(site.1.female[1:5],FIT.1.female)
saveRDS(object = AKDE.1.female, file = "AKDE.1.female.RDS")
```

#### Load saved AKDE aligned UDs
```{r}
AKDE.1.female <- readRDS("AKDE.1.female.RDS")
overlap(AKDE.1.female)
```

#### Plot AKDE overlap
```{r}
png(file = "Overlap.1.female.png", width = 6.86, height = 6, units = "in", res = 600)
plot(AKDE.1.female, col.DF = "red", col.level = "black", col.grid = NA, level = NA)
title("aKDE Overlap (Site 1: females only)")
dev.off()
```

### AKDE OVERLAP FOR SITE 2

#### SITE 2 - male and female (n=7)
```{r}
AKDE.2 <- akde(site.2[1:7],FITS.2)
saveRDS(object = AKDE.2, file = "AKDE.2.RDS")
```

#### Load saved AKDE aligned UDs
```{r}
AKDE.2 <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/AKDE.2.RDS")
overlap(AKDE.2)
```

#### Plot AKDE overlap
```{r}
COL.2 <- c("red", "blue", "red", "blue", "red", "light blue", "blue") # blue = male; light blue = subadult male; red = female
png(file = "Overlap.2.png", width = 6.86, height = 6, units = "in", res = 600)
plot(AKDE.2, col.DF = COL.2, col.level = COL.2, col.grid = NA, level = NA) 
title("aKDE Overlap (Site 2: all individuals)")
dev.off()
```

#### SITE 2 - male (n=4)
```{r}
AKDE.2.male <- akde(site.2[1:4],FIT.2.male)
saveRDS(object = AKDE.2.male, file = "AKDE.2.male.RDS")
```

#### Load saved AKDE aligned UDs
```{r}
AKDE.2.male <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/AKDE.2.male.RDS")
overlap(AKDE.2.male)
```

#### Plot AKDE overlap
```{r}
png(file = "Overlap.2.male.adult.png", width = 6.86, height = 6, units = "in", res = 600)
plot(AKDE.2.male.adult, col.DF = "blue", col.level = "black", col.grid = NA, level = NA)
title("aKDE Overlap (Site 2: male adults only)")
dev.off()
```

#### SITE 2 - male adult (n=3)
```{r}
AKDE.2.male.adult <- akde(site.2.male.adult[1:3],FITS.2.male.adult)
saveRDS(object = AKDE.2.male.adult, file = "AKDE.2.male.adult.RDS")
```

#### Load saved AKDE aligned UDs
```{r}
AKDE.2.male.adult <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/AKDE.2.male.adult.RDS")
overlap(AKDE.2.male.adult)
```

#### Plot AKDE overlap
```{r}
png(file = "Overlap.2.male.adult.png", width = 6.86, height = 6, units = "in", res = 600)
plot(AKDE.2.male.adult, col.DF = "blue", col.level = "black", col.grid = NA, level = NA)
title("aKDE Overlap (Site 2: male adults only)")
dev.off()
```

#### SITE 2 - female (n=3)
```{r}
AKDE.2.female <- akde(site.2.female[1:3],FITS.2.female)
saveRDS(object = AKDE.2.female, file = "AKDE.2.female.RDS")
```

#### Load saved AKDE aligned UDs
```{r}
AKDE.2.female <- readRDS("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/R working directory/AKDE.2.female.RDS")
overlap(AKDE.2.female)
```

#### Plot AKDE overlap
```{r}
png(file = "Overlap.2.female.png", width = 6.86, height = 6, units = "in", res = 600)
plot(AKDE.2.female, col.DF = "red", col.level = "black", col.grid = NA, level = NA)
title("aKDE Overlap (Site 2: females only)")
dev.off()
```

### AKDE OVERLAP FOR SITE 3
#### SITE 3 - male and female (n=)
#### Load saved AKDE aligned UDs
#### Plot AKDE overlap
#### SITE 3 - male (n=)
#### Load saved AKDE aligned UDs
#### Plot AKDE overlap
#### SITE 3 - male adult (n=)
#### Load saved AKDE aligned UDs
#### Plot AKDE overlap
#### SITE 3 - female (n=)
#### Load saved AKDE aligned UDs
#### Plot AKDE overlap

# PAIRWISE ANALYSIS SEX COMPARISON
Creating a data frame from overlap values

## IMPORT META DATA SET
Import supplementry data set containing sex information
```{r}
METADATA <- read_csv("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/giant anteater data/Anteater_Results_Final.csv")
```

Correcting for mismatch entry between data and supplemetary data
```{r}
METADATA <- mutate(select(METADATA, 1:3), ID = if_else(condition = ID == 'Larry',
                                                       true = 'Larry 267',
                                                       false = ID))
```

### PAIRWISE SEX COMPARISON ANALYSIS FOR SITE 1
```{r}
# extracting median layer
overlap.1 <- overlap(object = AKDE.1, level = 0.95) # assigns the overlap results as an object
overlap.1.median <- overlap.1$CI[ , , 2] # extract the median layer (pulling out the section) of the cube (aka array)
  # [, , ,] = [row, column, layer] of the cube/array
  # values of layers: 1 = low, 2 = median (50%), 3 = high
overlap.1.median[upper.tri(overlap.1.median, diag = TRUE)] <- NA # removing the upper triangle & diagonal of the matrix the triangle are duplicate values 
  # because its a symmetric matrix and removing the diagonal because it is the value of home range of itself, .-. we change upper and diag to NA, 
  # setting diag = TRUE, because 1. select the values you don't want then 2. remove the values by using "<- NA"
overlap.1.median # to check everything is correct (full-screen console for best results)

# converting the overlap median layer matrix triangle into a pairwise dataframe
pairwise.1.matrix <- as.data.frame(overlap.1.median) # Convert matrix to data frame
pairwise.1.matrix$anteater_A <- rownames(pairwise.1.matrix) # add column of individual names
pairwise.1.pivot <- pivot_longer(pairwise.1.matrix, cols = -anteater_A, names_to = 'anteater_B', values_to = 'overlap', values_drop_na = TRUE)
  # table is too wide .-. rotate it to make it long

# add columns to the dataframe matrix, general syntax -> join_type(firstTable, secondTable, by=columnTojoinOn)
pairwise.1.pivot.A <- left_join(pairwise.1.pivot, rename(METADATA, anteater_A = ID), by = "anteater_A")
# adding anteater_A info to matrix
pairwise.1.pivot.B <- left_join(pairwise.1.pivot.A, rename(METADATA, anteater_B = ID), by = "anteater_B", suffix = c(".A", ".B"))
# adding anteater_B info to matrix with anteater_A info
DATA.pairwise.1 <- mutate(pairwise.1.pivot.B, sex_comparison = case_when(paste(Sex.A, Sex.B) == "Male Male" ~ "male:male",
                                                                       paste(Sex.A, Sex.B) == "Female Female" ~ "female:female",
                                                                       paste(Sex.A, Sex.B) == "Male Female" ~ "male:female",
                                                                       paste(Sex.A, Sex.B) == "Female Male" ~ "male:female"))
# adding column to indicate which sexes that are being compared
DATA.pairwise.1 # to check if matrix has all the correct columns, variables etc., with no NA values

# removing subadults from dataframe matrix
pairwise.1.df.A <- DATA.pairwise.1[which(DATA.pairwise.1$Age.A != "Subadult"),] # removing subadults from anteater_A from matrix
DATA.pairwise.1.adult <- pairwise.1.df.A[which(pairwise.1.df.A$Age.B != "Subadult"),] # removing subadults from anteater_B from matrix with anteater_A filtered

```

#### Plot pairwise sex comparison for SITE 1 - male and female
```{r}
ggplot(data = DATA.pairwise.1, mapping = aes(x = sex_comparison, y = overlap, fill = sex_comparison)) + 
  geom_boxplot() +
  ylab("Overlap") +
  xlab("Sex Comparison") +
  ggtitle("Overlap pairwise comparison of sexes (Site 1: all)") +
  theme_bw() +
  scale_y_continuous(limits = c(0,1))
ggsave(filename = "pairwise.1.png", plot = last_plot(), device = NULL,
       path = NULL, scale = 1, width = 6.86, height = 6, units = "in", dpi = 600)
```

#### Plot pairwise sex comparison for SITE 1 - adult
```{r}
ggplot(data = DATA.pairwise.1.adult, mapping = aes(x = sex_comparison, y = overlap, fill = sex_comparison)) + 
  geom_boxplot() +
  ylab("Overlap") +
  xlab("Sex Comparison") +
  ggtitle("Overlap pairwise comparison of sexes (Site 1: adults only)") +
  theme_bw() +
  scale_y_continuous(limits = c(0,1))
ggsave(filename = "pairwise.1.adult.png", plot = last_plot(), device = NULL,
       path = NULL, scale = 1, width = 6.86, height = 6, units = "in", dpi = 600)
```


### PAIRWISE SEX COMPARISON ANALYSIS FOR SITE 2
```{r}
# extracting median layer
overlap.2 <- overlap(object = AKDE.2, level = 0.95) # assigns the overlap results as an object
overlap.2.median <- overlap.2$CI[ , , 2] # extract the median layer (pulling out the section) of the cube (aka array)
overlap.2.median[upper.tri(overlap.2.median, diag = TRUE)] <- NA # removing the upper triangle & diagonal of the matrix
#View(overlap.2.median) # to check everything is correct (full-screen console for best results)

# converting the overlap median layer matrix triangle into a pairwise dataframe
pairwise.2.matrix <- as.data.frame(overlap.2.median) # Convert matrix to data frame
pairwise.2.matrix$anteater_A <- rownames(pairwise.2.matrix) # add column of individual names
pairwise.2.pivot <- pivot_longer(pairwise.1.matrix, cols = -anteater_A, names_to = 'anteater_B', values_to = 'overlap', values_drop_na = TRUE)
  # table is too wide .-. rotate it to make it long

# add columns to the dataframe matrix, general syntax -> join_type(firstTable, secondTable, by=columnTojoinOn)
pairwise.2.pivot.A <- left_join(pairwise.2.pivot, rename(METADATA, anteater_A = ID), by = "anteater_A")
# adding anteater_A info to matrix
pairwise.2.pivot.B <- left_join(pairwise.2.pivot.A, rename(METADATA, anteater_B = ID), by = "anteater_B", suffix = c(".A", ".B"))
# adding anteater_B info to matrix with anteater_A info
DATA.pairwise.2 <- mutate(pairwise.2.pivot.B, sex_comparison = case_when(paste(Sex.A, Sex.B) == "Male Male" ~ "male:male",
                                                                       paste(Sex.A, Sex.B) == "Female Female" ~ "female:female",
                                                                       paste(Sex.A, Sex.B) == "Male Female" ~ "male:female",
                                                                       paste(Sex.A, Sex.B) == "Female Male" ~ "male:female"))
# adding column to indicate which sexes that are being compared
DATA.pairwise.2 # to check if matrix is good, has all the correct columns, variables etc. ie. no NA values

# removing subadults from dataframe matrix
pairwise.2.df.A <- DATA.pairwise.2[which(DATA.pairwise.2$Age.A != "Subadult"),] # removing subadults from anteater_A from matrix
DATA.pairwise.2.adult <- pairwise.2.df.A[which(DATA.pairwise.2$Age.B != "Subadult"),] # removing subadults from anteater_B from matrix with anteater_A filtered

```

#### Plot pairwise sex comparison for SITE 2 - male and female
```{r}
ggplot(data = DATA.pairwise.2, mapping = aes(x = sex_comparison, y = overlap, fill = sex_comparison)) + 
  geom_boxplot() +
  ylab("Overlap") +
  xlab("Sex Comparison") +
  ggtitle("Overlap pairwise comparison of sexes (Site 2: all)") +
  theme_bw() +
  scale_y_continuous(limits = c(0,1))
ggsave(filename = "pairwise.2.png", plot = last_plot(), device = NULL,
       path = NULL, scale = 1, width = 6.86, height = 6, units = "in", dpi = 600)
```

#### Plot pairwise sex comparison for SITE 2 - adult
```{r}
ggplot(data = DATA.pairwise.2.adult, mapping = aes(x = sex_comparison, y = overlap, fill = sex_comparison)) + 
  geom_boxplot() +
  ylab("Overlap") +
  xlab("Sex Comparison") +
  ggtitle("Overlap pairwise comparison of sexes (Site 2: adults only)") +
  theme_bw() +
  scale_y_continuous(limits = c(0,1))
ggsave(filename = "pairwise.2.adult.png", plot = last_plot(), device = NULL,
       path = NULL, scale = 1, width = 6.86, height = 6, units = "in", dpi = 600)
```


### PAIRWISE SEX COMPARISON ANALYSIS FOR SITE 3
```{r}

```

#### Plot pairwise sex comparison for SITE 3 - male and female
```{r}

```

#### Plot pairwise sex comparison for SITE 3 - adult
```{r}

```


### PAIRWISE SEX COMPARISON ANALYSIS FOR SITE 1 & 2, NEED TO ADD SITE 3


#### Male and female
DATA.pairwise <- bind_rows(pairwise.1.df, pairwise.2.df)
#### Adults
DATA.pairwise.adult <- bind_rows(pairwise.1.df.adult, pairwise.2.df.adult)

```{r}

```

## Quick test to see if differences are significant -------
```{r}
test.sex <- glmer(overlap ~ sex_comparison + (1|Sex.A), family = "binomial", data = pairwise.df.adult)
summary(test.sex)
```


# PROXIMITY ANALYSIS BETWEEN SEX (PAIRWISE) *** NEED TO SPLIT AND RUN PER SITE ***
refer to help("proximity")

## SET UP PROXIMITY DATA FRAME
create empty columns for where the result information will be added/filled into
```{r}

```

### PROXIMITY ANALYSIS BETWEEN SEX FOR SITE 1
Using tryCatch
```{r}
}
```

#### Load Proximity Analysis results
```{r}
DATA.proximity.1 <- read.csv("C:/Users/achhen/OneDrive - UBC/BIOL 452 Directed Studies - Giant Anteaters/Github/giantanteater/giant anteater data/DATA.proximity.1.csv")
DATA.proximity.1 <- read_csv("DATA.proximity.1.csv")
```

#### Plot Proximity Analysis results
```{r}
FIG.proximity.1 <- 
  ggplot(data = DATA.proximity.1, aes(y = proximity_est, x = overlap, col = sex_comparison)) +
  geom_hline(yintercept = 1, col = "grey70", linetype = "dashed") +
  geom_point(size = 0.5) +
  geom_segment(aes(x = overlap, xend = overlap, y = proximity_low, yend = proximity_high), size = 0.3) +
  scale_y_log10(expand = c(0,0.1)) +
  scale_x_continuous(limits = c(0,1), expand = c(0,0.02)) +
  scale_color_manual(values = c("#d1495b", "#009E73", "#0072B2"),
                     labels = c("Female - Female", "Male - Female", "Male - Male"),
                     name = "") +
  ylab("Proximity ratio") +
  xlab("Home range overlap") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title.y = element_text(size=8, family = "sans", face = "bold"),
        axis.title.x = element_text(size=8, family = "sans", face = "bold"),
        axis.text.y = element_text(size=6, family = "sans"),
        axis.text.x  = element_text(size=6, family = "sans"),
        legend.text = element_text(size=6, family = "sans", face = "bold"),
        plot.title = element_text(hjust = -0.05, size = 12, family = "sans", face = "bold"),
        legend.position = c(0.8, 0.8),
        legend.key=element_blank(),
        panel.background = element_rect(fill = "transparent"),
        legend.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = "transparent", color = NA),
        plot.margin = unit(c(0.2,0.1,0.2,0.2), "cm"))

ggsave(FIG.proximity.1,
       width = 3.23, height = 2, units = "in",
       dpi = 600,
       bg = "transparent",
       file="Anteater_Proximity_Site1.png")
```



#############################

SITE 1 - male and female (n=12)
SITE 1 - male (n=7)
SITE 1 - male adult (n=4)
SITE 1 - female (n=5)

SITE 2 - male and female (n=7)
SITE 2 - male (n=4)
SITE 2 - male adult (n=3)
SITE 2 - female (n=3)

SITE 3 - male and female (n=)
SITE 3 - male (n=)
SITE 3 - male adult (n=)
SITE 3 - female (n=)


